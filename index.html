<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BG Predictor — Professional Sports Analysis</title>
  <style>
    :root {
      --bg-primary: #0f1419;
      --bg-secondary: #1a1f29;
      --card: #242b3d;
      --card-hover: #2d3548;
      --muted: #8b9dc3;
      --accent: #00c851;
      --accent2: #007e33;
      --accent-light: #39ff74;
      --danger: #ff3547;
      --warning: #ffbb33;
      --text-primary: #ffffff;
      --text-secondary: #dbe7fd;
      --border: rgba(139, 157, 195, 0.2);
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, #0a0e14 100%);
      color: var(--text-primary);
      min-height: 100vh;
      position: relative;
    }
    
    /* Sports betting website background pattern */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(0, 200, 81, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(0, 126, 51, 0.08) 0%, transparent 50%);
      z-index: -1;
    }

    .wrap {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding: 20px 0;
      border-bottom: 2px solid var(--border);
      flex-wrap: wrap;
      gap: 16px;
    }

    .brand {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .mark {
      width: 56px;
      height: 56px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 1.4rem;
      user-select: none;
      color: white;
      box-shadow: 0 4px 12px rgba(0, 200, 81, 0.3);
    }

    .brand-text h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }

    .brand-text p {
      margin: 2px 0 0 0;
      color: var(--muted);
      font-size: 13px;
    }

    .status-badge {
      background: rgba(0, 200, 81, 0.2);
      color: var(--accent-light);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--accent);
    }

    .panel {
      background: var(--card);
      padding: 20px;
      border-radius: 16px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    .panel:hover {
      background: var(--card-hover);
      border-color: rgba(0, 200, 81, 0.3);
    }

    .panel-title {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 12px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title::before {
      content: '⚡';
      font-size: 20px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: var(--muted);
      font-weight: 500;
    }

    input, select, button, textarea {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
      font-size: 16px;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0, 200, 81, 0.1);
    }

    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    input[type=text], select, textarea {
      flex: 1;
      min-width: 120px;
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: white;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: all 0.3s ease;
      min-width: 120px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 12px rgba(0, 200, 81, 0.3);
    }

    button.primary:hover {
      background: linear-gradient(135deg, var(--accent-light), var(--accent));
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 200, 81, 0.4);
    }

    button.danger {
      background: linear-gradient(135deg, var(--danger), #cc2a3a);
      color: white;
      font-weight: 700;
    }

    .results-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--text-secondary);
      background: rgba(255, 255, 255, 0.02);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px 8px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }

    th {
      background: rgba(0, 200, 81, 0.1);
      color: var(--text-primary);
      font-weight: 600;
    }

    .muted {
      color: var(--muted);
    }

    .stars {
      font-size: 18px;
      color: #ffd700;
      text-shadow: 0 0 4px rgba(255, 215, 0, 0.3);
    }

    footer {
      margin-top: 40px;
      padding: 20px 0;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
      border-top: 1px solid var(--border);
    }

    #slipPanel {
      position: sticky;
      top: 20px;
      max-height: 80vh;
      overflow-y: auto;
    }

    #slipList {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    #slipList li {
      background: linear-gradient(135deg, rgba(0, 200, 81, 0.15), rgba(0, 126, 51, 0.1));
      margin-bottom: 12px;
      border-radius: 12px;
      padding: 16px;
      position: relative;
      border: 1px solid rgba(0, 200, 81, 0.3);
      transition: all 0.3s ease;
    }

    #slipList li:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 200, 81, 0.2);
    }

    #slipList li button.removeSlipItem {
      position: absolute;
      top: 8px;
      right: 8px;
      background: var(--danger);
      border: none;
      color: white;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      user-select: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #slipControls {
      margin-top: 16px;
      display: flex;
      gap: 12px;
    }

    #slipControls button {
      flex: 1;
      padding: 12px;
    }

    .multi-games-section {
      background: linear-gradient(135deg, rgba(0, 200, 81, 0.05), rgba(0, 126, 51, 0.02));
      border: 1px solid rgba(0, 200, 81, 0.2);
    }

    .game-input {
      background: rgba(255, 255, 255, 0.03);
      border: 1px dashed var(--border);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .game-input:last-child {
      margin-bottom: 0;
    }

    .remove-game {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    /* Mobile Styles */
    @media(max-width: 768px) {
      body {
        padding: 0;
        margin: 0;
      }
      
      .wrap {
        padding: 12px;
      }

      header {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
        margin-bottom: 16px;
        padding: 16px 0;
      }

      .brand {
        justify-content: center;
        margin-bottom: 12px;
      }

      .row {
        flex-direction: column;
        gap: 12px;
      }

      input[type=text], select, button.primary, textarea {
        width: 100%;
        min-width: unset;
      }

      .results-container {
        grid-template-columns: 1fr;
        gap: 16px;
      }

      .results-grid {
        grid-template-columns: 1fr;
      }

      #slipPanel {
        position: static;
        max-height: none;
        order: -1;
      }

      .panel {
        padding: 16px;
      }

      table {
        font-size: 14px;
      }

      th, td {
        padding: 8px 4px;
      }

      #slipControls {
        flex-direction: column;
        gap: 8px;
      }

      .mark {
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
      }

      .brand-text h1 {
        font-size: 20px;
      }
    }

    @media(max-width: 480px) {
      .wrap {
        padding: 8px;
      }

      input, select, button, textarea {
        padding: 14px;
        font-size: 16px;
      }

      table {
        font-size: 12px;
      }

      th, td {
        padding: 6px 3px;
      }
    }

    /* Canvas for slip image generation */
    #slipCanvas {
      display: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="mark">BG</div>
        <div class="brand-text">
          <h1>BG Predictor</h1>
          <p>Professional Sports Analysis & Predictions</p>
        </div>
      </div>
      <div class="status-badge">● LIVE ANALYSIS</div>
    </header>

    <div class="panel">
      <div class="panel-title">Quick Match Analysis</div>
      <div class="row">
        <input id="teamA" type="text" placeholder="Home Team" />
        <input id="teamB" type="text" placeholder="Away Team" />
        <select id="sport">
          <option value="football">Football (Soccer)</option>
          <option value="basketball">Basketball</option>
          <option value="hockey">Hockey</option>
        </select>
        <button id="analyzeBtn" class="primary">Analyze Match</button>
      </div>
      <div class="muted" style="margin-top:12px">
        🎯 Advanced AI-powered analysis with historical data simulation
      </div>
    </div>

    <div class="panel multi-games-section">
      <div class="panel-title">Multi-Game Deep Analysis</div>
      <div class="muted" style="margin-bottom:16px">
        Add multiple games for comprehensive analysis and betting strategy
      </div>
      <div id="multiGamesContainer">
        <div class="game-input">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px">
            <div>
              <label>Game 1 - Home Team</label>
              <input type="text" placeholder="Enter home team" class="multi-teamA" />
            </div>
            <div>
              <label>Game 1 - Away Team</label>
              <input type="text" placeholder="Enter away team" class="multi-teamB" />
            </div>
          </div>
          <div class="row">
            <select class="multi-sport">
              <option value="football">Football</option>
              <option value="basketball">Basketball</option>
              <option value="hockey">Hockey</option>
            </select>
            <button class="remove-game" onclick="removeGame(this)">Remove Game</button>
          </div>
        </div>
      </div>
      <div style="display:flex;gap:12px;margin-top:12px">
        <button id="addGameBtn" class="primary" style="flex:1">Add Another Game</button>
        <button id="analyzeMultiBtn" class="primary" style="flex:1">Analyze All Games</button>
      </div>
    </div>

    <div class="panel" id="todayPanel">
      <div class="panel-title">Today's Featured Matches</div>
      <div class="muted">AI-generated daily predictions with high confidence ratings</div>
      <div id="todayList" style="margin-top:16px"></div>
    </div>

    <div class="results-container">
      <div class="results-grid">
        <div class="panel full-width" id="analysisPanel">
          <div id="analysisTitle" style="font-weight:800;font-size:20px">Ready for Analysis</div>
          <div id="analysisSummary" class="muted">Select teams and sport, then click analyze for comprehensive prediction</div>

          <div id="tablesWrap" style="margin-top:20px;display:none">
            <h4 style="margin:12px 0 8px 0">Head-to-Head Record (Last 5)</h4>
            <table id="h2hTable"><thead><tr><th>Date</th><th>Score</th><th>Total</th><th>Result</th></tr></thead><tbody></tbody></table>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px">
              <div>
                <h4 style="margin:12px 0 8px 0">Home Team - Recent Form</h4>
                <table id="teamATable"><thead><tr><th>Date</th><th>Score</th><th>Total</th><th>Result</th></tr></thead><tbody></tbody></table>
              </div>
              <div>
                <h4 style="margin:12px 0 8px 0">Away Team - Recent Form</h4>
                <table id="teamBTable"><thead><tr><th>Date</th><th>Score</th><th>Total</th><th>Result</th></tr></thead><tbody></tbody></table>
              </div>
            </div>

            <h4 style="margin:20px 0 8px 0">Statistical Analysis</h4>
            <table id="highLowTable"><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody></tbody></table>
          </div>
        </div>

        <div class="panel" id="predPanel">
          <div class="panel-title">Prediction Results</div>
          <div style="margin-top:12px"><strong>Recommended Pick:</strong> <span id="pick" style="color:var(--accent-light)">-</span></div>
          <div style="margin-top:8px"><strong>Expected Range:</strong> <span id="totalRange" style="color:var(--accent-light)">-</span></div>
          <div style="margin-top:8px"><strong>Confidence Level:</strong><br><span id="confStars" class="stars">-</span><br><span id="confPct" class="muted"></span></div>
          <div style="margin-top:12px"><strong>Analysis Summary:</strong>
            <div id="rationale" class="muted" style="margin-top:8px;font-size:14px"></div>
          </div>
          <div style="margin-top:20px; display:flex; flex-direction:column; gap:12px;">
            <button id="addToSlip" class="primary">Add to Bet Slip</button>
            <button id="downloadJson" class="primary" style="background:linear-gradient(135deg, var(--warning), #e6a000);">Download Analysis</button>
          </div>
        </div>
      </div>

      <div class="panel" id="slipPanel">
        <div class="panel-title">Bet Slip</div>
        <ul id="slipList"></ul>
        <div id="slipControls">
          <button id="downloadSlipImage" class="primary">Download Slip Image</button>
          <button id="clearSlip" class="danger">Clear All</button>
        </div>
      </div>
    </div>

    <canvas id="slipCanvas"></canvas>

    <footer>
      BG Predictor © 2025 | Advanced Sports Analytics Platform | Predictions based on AI analysis
    </footer>
  </div>

<script>
  // Utility functions
  function seedFromString(s){
    let h=2166136261 >>> 0;
    for(let i=0;i<s.length;i++){
      h = Math.imul(h ^ s.charCodeAt(i), 16777619) >>> 0;
    }
    return function(){
      h += 0x6D2B79F5;
      let t = Math.imul(h ^ (h >>> 15), 1 | h);
      t ^= t + Math.imul(t ^ (t >>> 7), 61 | t);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
  }

  function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }

  function formatStars(perc){
    let p = Number(perc);
    if(!isFinite(p)) p = 0;
    p = Math.round(clamp(p,0,100));
    const stars = Math.round(p/20);
    return '★'.repeat(stars) + '☆'.repeat(5-stars) + ' ' + p + '%';
  }

  function simulateLastMatches(seedFn, sport){
    const out = [];
    for(let i=0;i<5;i++){
      const r = seedFn();
      let a,b;
      if(sport==='basketball'){
        a = 60 + Math.floor(r*45); b = 60 + Math.floor(seedFn()*45);
      } else if(sport==='hockey'){
        a = Math.floor(r*6); b = Math.floor(seedFn()*6);
      } else {
        a = Math.floor(r*4); b = Math.floor(seedFn()*4);
      }
      const date = new Date(Date.now() - (i+1)*86400000).toISOString().slice(0,10);
      out.push({date,score:`${a}-${b}`,goalsA:a,goalsB:b,total:a+b,winner: a>b? 'Home' : a<b? 'Away':'Draw'});
    }
    return out;
  }

  function highestLowFrom(arr){
    if(!arr || arr.length===0) return null;
    const nums = arr.map(x=>x.total).filter(n=>typeof n==='number' && !Number.isNaN(n));
    if(nums.length===0) return null; 
    return Math.min(...nums);
  }

  function computeExpectation(teamGames, oppGames, sport){
    const avgTeam = teamGames.length? teamGames.reduce((s,g)=>s+g.total,0)/teamGames.length : (sport==='basketball'?120:2.4);
    const avgOpp = oppGames.length? oppGames.reduce((s,g)=>s+g.total,0)/oppGames.length : (sport==='basketball'?115:2.2);
    const expectedTotal = (avgTeam + avgOpp)/2;
    return {avgTeam,avgOpp,expectedTotal};
  }

  function analyzeTeams(teamA, teamB, sport){
    const seed = seedFromString(teamA+'|'+teamB+'|'+sport);
    const seedA = seedFromString(teamA+'|'+sport);
    const seedB = seedFromString(teamB+'|'+sport);
    const h2h = simulateLastMatches(seed,sport);
    const teamA5 = simulateLastMatches(seedA,sport);
    const teamB5 = simulateLastMatches(seedB,sport);

    const h2hLow = highestLowFrom(h2h);
    const aLow = highestLowFrom(teamA5);
    const bLow = highestLowFrom(teamB5);
    const combinedHighestLow = [h2hLow,aLow,bLow].filter(x=>x!==null).length? Math.max(...[h2hLow,aLow,bLow].filter(x=>x!==null)) : null;

    const {avgTeam,avgOpp,expectedTotal} = computeExpectation(teamA5, teamB5, sport);

    let strengthA = teamA5.reduce((s,g)=>s+g.goalsA,0)/(teamA5.length||1);
    let strengthB = teamB5.reduce((s,g)=>s+g.goalsA,0)/(teamB5.length||1);

    strengthA = strengthA * 1.05;
    const totalStr = strengthA + strengthB;
    let pA = totalStr? (strengthA/totalStr):0.5;
    let pB = totalStr? (strengthB/totalStr):0.5;
    const drawAdj = sport==='football'? 0.14 : 0.02;
    pA = pA*(1-drawAdj); pB = pB*(1-drawAdj);

    const dataFactor = clamp((h2h.length + teamA5.length + teamB5.length)/15, 0, 1);
    const closeness = 1 - Math.abs(pA - pB);
    const baseConfidence = (0.5*dataFactor + 0.5*(Math.max(pA,pB))) * 100;
    let confidence = clamp(baseConfidence*(1 - 0.2*closeness), 10, 98);

    if(confidence < 85) confidence = 85;
    if(confidence > 90) confidence = 90;

    let pick;
    if(Math.abs(pA-pB) < 0.06 && sport==='football') pick = 'Draw / Double chance';
    else pick = pA>pB? teamA: teamB;

    const lowRange = Math.floor(Math.max(0, expectedTotal - (sport==='basketball'?10:1)));
    const highRange = Math.ceil(expectedTotal + (sport==='basketball'?10:2));

    const rationale = [];
    rationale.push(`Expected total: ${expectedTotal.toFixed(2)} (${sport})`);
    rationale.push(`Conservative floor: ${combinedHighestLow ?? 'N/A'}`);
    rationale.push(`Team strengths: ${teamA} (${(strengthA).toFixed(2)}), ${teamB} (${(strengthB).toFixed(2)})`);
    rationale.push(`Data confidence: ${Math.round(confidence)}% based on ${h2h.length + teamA5.length + teamB5.length} matches`);

    return {
      h2h, teamA5, teamB5, h2hLow, aLow, bLow, combinedHighestLow,
      expectedTotal, pick, confidence, lowRange, highRange, rationale
    };
  }

  // UI Functions
  function clearTables(){
    ['h2hTable','teamATable','teamBTable','highLowTable'].forEach(id=>{
      const tbody = document.getElementById(id).querySelector('tbody');
      tbody.innerHTML = '';
    });
    document.getElementById('tablesWrap').style.display = 'none';
    document.getElementById('analysisTitle').textContent = 'Ready for Analysis';
    document.getElementById('analysisSummary').textContent = 'Select teams and sport, then click analyze for comprehensive prediction';
    document.getElementById('pick').textContent = '-';
    document.getElementById('totalRange').textContent = '-';
    document.getElementById('confStars').textContent = '-';
    document.getElementById('confPct').textContent = '';
    document.getElementById('rationale').innerHTML = '';
  }

  function fillTable(id, rows){
    const tbody = document.getElementById(id).querySelector('tbody');
    tbody.innerHTML = '';
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      for(const key in r){
        const td = document.createElement('td');
        td.textContent = r[key];
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    });
  }

  function updateUI(result, teamA, teamB){
    if(!result) return;
    document.getElementById('analysisTitle').textContent = `${teamA} vs ${teamB} | ${document.getElementById('sport').value.toUpperCase()}`;
    document.getElementById('analysisSummary').textContent = '';
    document.getElementById('tablesWrap').style.display = 'block';

    fillTable('h2hTable', result.h2h.map(m=>({
      Date: m.date,
      Score: m.score,
      Total: m.total,
      Result: m.winner
    })));

    fillTable('teamATable', result.teamA5.map(m=>({
      Date: m.date,
      Score: m.score,
      Total: m.total,
      Result: m.goalsA > m.goalsB ? 'W' : (m.goalsA < m.goalsB ? 'L' : 'D')
    })));

    fillTable('teamBTable', result.teamB5.map(m=>({
      Date: m.date,
      Score: m.score,
      Total: m.total,
      Result: m.goalsB > m.goalsA ? 'W' : (m.goalsB < m.goalsA ? 'L' : 'D')
    })));

    fillTable('highLowTable', [
      {Metric: 'H2H Lowest Total', Value: result.h2hLow ?? 'N/A'},
      {Metric: `${teamA} Lowest`, Value: result.aLow ?? 'N/A'},
      {Metric: `${teamB} Lowest`, Value: result.bLow ?? 'N/A'},
      {Metric: 'Combined Floor', Value: result.combinedHighestLow ?? 'N/A'},
    ]);

    document.getElementById('pick').textContent = result.pick;
    document.getElementById('totalRange').textContent = `${result.lowRange} - ${result.highRange}`;
    document.getElementById('confStars').textContent = formatStars(result.confidence);
    document.getElementById('confPct').textContent = `${Math.round(result.confidence)}% confidence`;
    document.getElementById('rationale').innerHTML = result.rationale.map(x=>`<div style="margin-bottom:4px">${x}</div>`).join('');
  }

  // Analysis Functions
  let currentAnalysis = null;
  let slipItems = JSON.parse(localStorage.getItem('betSlip')) || [];

  function onAnalyzeClick(){
    const teamA = document.getElementById('teamA').value.trim();
    const teamB = document.getElementById('teamB').value.trim();
    const sport = document.getElementById('sport').value;

    if(!teamA || !teamB){
      alert('Please enter both teams.');
      return;
    }
    if(teamA.toLowerCase() === teamB.toLowerCase()){
      alert('Please enter different team names.');
      return;
    }

    try {
      const result = analyzeTeams(teamA, teamB, sport);
      updateUI(result, teamA, teamB);
      currentAnalysis = {teamA, teamB, sport, result};
    } catch(e) {
      console.error('Analysis error:', e);
      alert('Analysis failed. Check console for details.');
    }
  }

  // Multi-game analysis
  let gameCount = 1;

  function addGame(){
    gameCount++;
    const container = document.getElementById('multiGamesContainer');
    const gameDiv = document.createElement('div');
    gameDiv.className = 'game-input';
    gameDiv.innerHTML = `
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:12px">
        <div>
          <label>Game ${gameCount} - Home Team</label>
          <input type="text" placeholder="Enter home team" class="multi-teamA" />
        </div>
        <div>
          <label>Game ${gameCount} - Away Team</label>
          <input type="text" placeholder="Enter away team" class="multi-teamB" />
        </div>
      </div>
      <div class="row">
        <select class="multi-sport">
          <option value="football">Football</option>
          <option value="basketball">Basketball</option>
          <option value="hockey">Hockey</option>
        </select>
        <button class="remove-game" onclick="removeGame(this)">Remove Game</button>
      </div>
    `;
    container.appendChild(gameDiv);
  }

  function removeGame(button){
    button.closest('.game-input').remove();
    updateGameNumbers();
  }

  function updateGameNumbers(){
    const games = document.querySelectorAll('.game-input');
    games.forEach((game, index) => {
      const labels = game.querySelectorAll('label');
      if(labels.length >= 2){
        labels[0].textContent = `Game ${index + 1} - Home Team`;
        labels[1].textContent = `Game ${index + 1} - Away Team`;
      }
    });
    gameCount = games.length;
  }

  function analyzeMultipleGames(){
    const games = [];
    const gameInputs = document.querySelectorAll('.game-input');
    
    gameInputs.forEach((gameDiv, index) => {
      const teamA = gameDiv.querySelector('.multi-teamA').value.trim();
      const teamB = gameDiv.querySelector('.multi-teamB').value.trim();
      const sport = gameDiv.querySelector('.multi-sport').value;
      
      if(teamA && teamB){
        games.push({teamA, teamB, sport, gameNumber: index + 1});
      }
    });

    if(games.length === 0){
      alert('Please add at least one complete game with both teams.');
      return;
    }

    let analysisResults = [];
    let analysisHtml = '<div style="font-weight:800;font-size:20px;margin-bottom:16px">Multi-Game Analysis Results</div>';
    
    games.forEach(game => {
      try {
        const result = analyzeTeams(game.teamA, game.teamB, game.sport);
        analysisResults.push({...game, result});
        
        analysisHtml += `
          <div style="background:rgba(0,200,81,0.1);padding:16px;border-radius:12px;margin-bottom:16px;border:1px solid rgba(0,200,81,0.2)">
            <h4 style="margin:0 0 8px 0;color:var(--accent-light)">Game ${game.gameNumber}: ${game.teamA} vs ${game.teamB} (${game.sport})</h4>
            <div><strong>Pick:</strong> ${result.pick}</div>
            <div><strong>Range:</strong> ${result.lowRange} - ${result.highRange}</div>
            <div><strong>Confidence:</strong> ${formatStars(result.confidence)}</div>
            <div style="margin-top:8px;font-size:14px;color:var(--muted)">${result.rationale[0]}</div>
          </div>
        `;
      } catch(e) {
        analysisHtml += `
          <div style="background:rgba(255,53,71,0.1);padding:16px;border-radius:12px;margin-bottom:16px;border:1px solid rgba(255,53,71,0.2)">
            <h4 style="margin:0 0 8px 0;color:var(--danger)">Game ${game.gameNumber}: ${game.teamA} vs ${game.teamB} - Analysis Failed</h4>
            <div>Error analyzing this game. Please check team names.</div>
          </div>
        `;
      }
    });

    document.getElementById('analysisTitle').innerHTML = analysisHtml;
    document.getElementById('analysisSummary').textContent = '';
    document.getElementById('tablesWrap').style.display = 'none';
    
    // Clear single game prediction panel
    document.getElementById('pick').textContent = 'See multi-game results';
    document.getElementById('totalRange').textContent = `${analysisResults.length} games analyzed`;
    document.getElementById('confStars').textContent = '★★★★★';
    document.getElementById('confPct').textContent = 'Multi-game analysis';
    document.getElementById('rationale').innerHTML = '<div>Review individual game predictions above</div>';
  }

  // Slip functions
  function renderSlip(){
    const ul = document.getElementById('slipList');
    ul.innerHTML = '';
    if(slipItems.length === 0){
      const li = document.createElement('li');
      li.textContent = 'Your bet slip is empty';
      li.style.color = '#888';
      li.style.textAlign = 'center';
      li.style.border = '1px dashed var(--border)';
      li.style.background = 'transparent';
      ul.appendChild(li);
      return;
    }
    slipItems.forEach((item, idx)=>{
      const li = document.createElement('li');
      li.innerHTML = `
        <div style="margin-bottom:8px"><strong>${item.teamA} vs ${item.teamB}</strong></div>
        <div style="font-size:14px">Sport: ${item.sport}</div>
        <div style="font-size:14px">Pick: <span style="color:var(--accent-light)">${item.result.pick}</span></div>
        <div style="font-size:14px">Confidence: ${formatStars(item.result.confidence)}</div>
      `;
      const btn = document.createElement('button');
      btn.className = 'removeSlipItem';
      btn.textContent = '×';
      btn.title = 'Remove this bet';
      btn.onclick = () => {
        slipItems.splice(idx,1);
        saveSlip();
        renderSlip();
      };
      li.appendChild(btn);
      ul.appendChild(li);
    });
  }

  function saveSlip(){
    localStorage.setItem('betSlip', JSON.stringify(slipItems));
  }

  function addToSlip(){
    if(!currentAnalysis){
      alert('Please analyze a game first.');
      return;
    }
    const exists = slipItems.some(item =>
      item.teamA.toLowerCase() === currentAnalysis.teamA.toLowerCase() &&
      item.teamB.toLowerCase() === currentAnalysis.teamB.toLowerCase() &&
      item.sport === currentAnalysis.sport
    );
    if(exists){
      alert('This game is already in your bet slip.');
      return;
    }
    slipItems.push(currentAnalysis);
    saveSlip();
    renderSlip();
    alert('Added to bet slip!');
  }

  function clearSlip(){
    if(confirm('Clear all bets from your slip?')){
      slipItems = [];
      saveSlip();
      renderSlip();
    }
  }

  // Generate slip image
  function generateSlipImage(){
    if(slipItems.length === 0){
      alert('Your bet slip is empty. Add some predictions first.');
      return;
    }

    const canvas = document.getElementById('slipCanvas');
    const ctx = canvas.getContext('2d');
    
    // Set canvas size
    canvas.width = 400;
    canvas.height = 150 + (slipItems.length * 120);
    
    // Background
    ctx.fillStyle = '#242b3d';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Header
    ctx.fillStyle = '#00c851';
    ctx.fillRect(0, 0, canvas.width, 60);
    
    // Title
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('BG PREDICTOR', canvas.width/2, 25);
    ctx.font = '14px Arial';
    ctx.fillText('Bet Slip Analysis', canvas.width/2, 45);
    
    // Date
    ctx.fillStyle = '#8b9dc3';
    ctx.font = '12px Arial';
    ctx.textAlign = 'right';
    ctx.fillText(new Date().toLocaleDateString(), canvas.width - 20, 80);
    
    // Bets
    let yPos = 100;
    slipItems.forEach((item, idx) => {
      // Bet background
      ctx.fillStyle = idx % 2 === 0 ? '#2d3548' : '#242b3d';
      ctx.fillRect(10, yPos, canvas.width - 20, 110);
      
      // Bet border
      ctx.strokeStyle = '#00c851';
      ctx.lineWidth = 1;
      ctx.strokeRect(10, yPos, canvas.width - 20, 110);
      
      // Game info
      ctx.fillStyle = '#ffffff';
      ctx.font = 'bold 16px Arial';
      ctx.textAlign = 'left';
      ctx.fillText(`${item.teamA} vs ${item.teamB}`, 20, yPos + 25);
      
      ctx.fillStyle = '#8b9dc3';
      ctx.font = '14px Arial';
      ctx.fillText(`Sport: ${item.sport.toUpperCase()}`, 20, yPos + 45);
      ctx.fillText(`Pick: ${item.result.pick}`, 20, yPos + 65);
      
      // Confidence
      ctx.fillStyle = '#ffd700';
      ctx.font = '12px Arial';
      const stars = '★'.repeat(Math.round(item.result.confidence/20));
      ctx.fillText(`Confidence: ${stars} ${Math.round(item.result.confidence)}%`, 20, yPos + 85);
      
      yPos += 120;
    });
    
    // Footer
    ctx.fillStyle = '#8b9dc3';
    ctx.font = '10px Arial';
    ctx.textAlign = 'center';
    ctx.fillText('Generated by BG Predictor - Professional Sports Analysis', canvas.width/2, canvas.height - 10);
    
    // Download
    const link = document.createElement('a');
    link.download = `BG_Predictor_Slip_${new Date().toISOString().slice(0,10)}.png`;
    link.href = canvas.toDataURL();
    link.click();
  }

  // Daily matches
  function generateDailyMatches(){
    const now = new Date();
    const daySeed = `${now.getFullYear()}-${now.getMonth()+1}-${now.getDate()}`;
    const seedFn = seedFromString(daySeed);
    
    const footballTeams = ['Manchester United','Barcelona','Real Madrid','PSG','Bayern Munich','Liverpool'];
    const basketballTeams = ['Lakers','Warriors','Bulls','Heat','Celtics','Nets'];
    const hockeyTeams = ['Maple Leafs','Canadiens','Rangers','Bruins','Blackhawks','Red Wings'];

    function pickTwo(arr){
      let a = Math.floor(seedFn()*arr.length);
      let b;
      do { b = Math.floor(seedFn()*arr.length); } while(b === a);
      return [arr[a], arr[b]];
    }

    const matches = [];
    for(let i=0;i<2;i++){
      let [a,b] = pickTwo(footballTeams);
      matches.push({teamA:a,teamB:b,sport:'football'});
      [a,b] = pickTwo(basketballTeams);
      matches.push({teamA:a,teamB:b,sport:'basketball'});
      [a,b] = pickTwo(hockeyTeams);
      matches.push({teamA:a,teamB:b,sport:'hockey'});
    }
    return matches;
  }

  function renderTodayMatches(){
    const matches = generateDailyMatches();
    const container = document.getElementById('todayList');
    container.innerHTML = '';
    matches.forEach(({teamA, teamB, sport}, i)=>{
      const btn = document.createElement('button');
      btn.textContent = `${teamA} vs ${teamB} (${sport.toUpperCase()})`;
      btn.style.marginBottom = '8px';
      btn.style.width = '100%';
      btn.style.padding = '12px';
      btn.style.borderRadius = '12px';
      btn.style.border = '1px solid var(--border)';
      btn.style.cursor = 'pointer';
      btn.style.background = 'rgba(0,200,81,0.1)';
      btn.style.color = '#ffffff';
      btn.style.transition = 'all 0.3s ease';
      btn.onmouseover = () => {
        btn.style.background = 'rgba(0,200,81,0.2)';
        btn.style.transform = 'translateY(-1px)';
      };
      btn.onmouseout = () => {
        btn.style.background = 'rgba(0,200,81,0.1)';
        btn.style.transform = 'translateY(0)';
      };
      btn.onclick = () => {
        document.getElementById('teamA').value = teamA;
        document.getElementById('teamB').value = teamB;
        document.getElementById('sport').value = sport;
        onAnalyzeClick();
      };
      container.appendChild(btn);
    });
  }

  // Event listeners
  document.getElementById('analyzeBtn').addEventListener('click', onAnalyzeClick);
  document.getElementById('addGameBtn').addEventListener('click', addGame);
  document.getElementById('analyzeMultiBtn').addEventListener('click', analyzeMultipleGames);
  document.getElementById('addToSlip').addEventListener('click', addToSlip);
  document.getElementById('clearSlip').addEventListener('click', clearSlip);
  document.getElementById('downloadSlipImage').addEventListener('click', generateSlipImage);

  // Download JSON analysis
  document.getElementById('downloadJson').addEventListener('click', () => {
    if(!currentAnalysis) {
      alert('Please analyze a game first.');
      return;
    }
    const data = {
      timestamp: new Date().toISOString(),
      teams: [currentAnalysis.teamA, currentAnalysis.teamB],
      sport: currentAnalysis.sport,
      analysis: currentAnalysis.result
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `BG_Analysis_${currentAnalysis.teamA}_vs_${currentAnalysis.teamB}_${currentAnalysis.sport}.json`;
    a.click();
    URL.revokeObjectURL(url);
  });

  // Enter key support
  ['teamA','teamB'].forEach(id=>{
    document.getElementById(id).addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){
        onAnalyzeClick();
      }
    });
  });

  // Initialize
  clearTables();
  renderTodayMatches();
  renderSlip();

</script>

</body>
</html>
